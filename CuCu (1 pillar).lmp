#LAMMPS Simulation for Cu-Cu Diffusion

#Initialization
units		metal
dimension   3
boundary    p   p   p
atom_style  atomic

#System Properties
reset_timestep 0
timestep 0.005
variable latparam equal 3.61
variable boxLength equal 100
variable temperature equal 600

#Create simulation box
lattice fcc ${latparam}
region simBox block 0 ${boxLength} 0 ${boxLength} 0 300
create_box 1 simBox
region lowerSlab block 0 ${boxLength} 0 ${boxLength} 20.0 185
region upperSlab block 0 ${boxLength} 0 ${boxLength} 195 270
create_atoms 1 region lowerSlab
create_atoms 1 region upperSlab
group upperSlabs region upperSlab
group lowerSlabs region lowerSlab
group lowerSlab type 1
group upperSlab type 2

#Rigid Top Slab
region rigid_layer block 0 100  0 100  280 290
create_atoms 1 region rigid_layer
group rigidtop region rigid_layer
#fix 2 rigidtop rigid/nve single

#Fixed Bottom Slab
region fixed_bottom block 0 ${boxLength} 0 ${boxLength} 0 10
create_atoms 1 region fixed_bottom
group fixedatoms region fixed_bottom
#fix 1 fixedatoms setforce 0.0 0.0 0.0

#Etching regions
region pillar1 block 0 21.245  0 100  75 165
region pillar2 block 21.245 78.755  78.755 100  75 165
region pillar3 block 78.755 100  0 100  75 165
region pillar4 block 21.245 78.755  0 21.245  75 165
delete_atoms region pillar1
delete_atoms region pillar2
delete_atoms region pillar3
delete_atoms region pillar4
 

#Potential
pair_style meam
pair_coeff * * library.meam Cu Cu.meam Cu

#Settings

#EQUILIBRATION
reset_timestep 0
timestep 0.005
velocity all create 300 12345


group non_fixed_atoms subtract all fixedatoms
fix 1 non_fixed_atoms npt temp 500.0 600.0 0.5 iso 0 0 5 drag 1
fix 2 fixedatoms setforce 0.0 0.0 0.0
thermo 400
thermo_style custom step lx ly lz press pxx pyy pzz pe temp

# Use custom dump for Ovito output
dump 1 all custom 250 dump.Cu.equil.* id x y z fx fy fz
run 400
unfix 1
undump 1

variable tmp equal "lz"
variable L0 equal ${tmp}
print "Initial Length, L0: ${L0}"

# DEFORMATION
reset_timestep 0

fix 1 non_fixed_atoms npt temp 500 600 0.5 iso 0 0 5 drag 1
fix 3 rigidtop move linear 0.0 0.0 -2 units box

# Use custom dump for Ovito output
dump 2 all custom 250 dump.Cu.comp.* id xs ys zs fx fy fz

# Display thermo, run
thermo 400
thermo_style custom step lx ly lz press pxx pyy pzz pe temp

run 100000

# Potential energy function
compute thermo_pe all pe

# SIMULATION DONE
print "All done"
